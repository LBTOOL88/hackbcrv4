<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HACK BACARAT MARK 8 - Final Fixed</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-green: #00ff7f;
      --bright-green-glow: rgba(0, 255, 127, 1);
      --dark-green-glow: rgba(0, 255, 127, 0.7);
      --text-green: #00e676;
      --text-light: #f0f0f0;
      --bg-black: #000000;
      --bg-dark-theme: #0d1117;
      --container-bg: rgba(10, 30, 20, 0.88);
      --input-bg: #161b22;
      --border-color: rgba(0, 255, 127, 0.25);
      --border-focus-color: var(--primary-green);
      --button-radius: 8px;
      --container-radius: 12px;
      --shadow-color-soft: rgba(0, 255, 127, 0.15);
      --pulse-glow-color: rgba(0, 255, 127, 0.4);
      --container-border-glow: rgba(0, 255, 127, 0.35);
    }

    /* --- BASE STYLES --- */
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Orbitron', monospace; background: var(--bg-black);
      color: var(--text-green); overflow-x: hidden; overflow-y: auto;
    }
    canvas#matrix { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    .hidden { display: none !important; }
    #app { z-index: 5; width: 100%; box-sizing: border-box; position: relative; }

    /* --- INTRO & LOGIN SCREEN --- */
    #introTextOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExOW1oZGhxcDlnYjE1MmsyZjRyYW1pejJuajJ3ZzhrOHUyZzZvaGVkNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/xTiTnwtxXU2SbrTsmA/giphy.gif'); background-color: var(--bg-black); background-size: cover; background-position: center center; background-repeat: no-repeat; color: var(--primary-green); display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 1.6em; z-index: 10000; text-align: center; padding: 20px; box-sizing: border-box; opacity: 1; transition: opacity 0.7s ease-out, visibility 0.7s ease-out; visibility: visible; }
    #introTextOverlay::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.65); z-index: 1; }
    #introTextOverlay > * { position: relative; z-index: 2; }
    #introTextOverlay.hidden-overlay { opacity: 0; visibility: hidden; }
    #introTextOverlay p { margin: 8px 0; min-height: 1.2em; white-space: pre-wrap; text-shadow: 0 0 6px var(--bg-black), 0 0 10px var(--bg-black); }
    #introTextOverlay .strong-line { font-size: 1.5em; color: var(--bright-green-glow); text-shadow: 0 0 8px var(--bg-black), 0 0 15px var(--dark-green-glow); letter-spacing: 1.5px; font-weight: 700; margin: 15px 0 !important; }
    .typewriter-cursor::after { content: '_'; animation: blink-caret 0.85s step-end infinite; color: var(--primary-green); }
    @keyframes blink-caret { from, to { opacity: 1; } 50% { opacity: 0; } }
    .intro { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; padding: 20px; box-sizing: border-box; }
    .intro h2 { color: var(--primary-green); text-shadow: 0 0 8px var(--dark-green-glow), 0 0 25px var(--dark-green-glow); margin-bottom: 35px; font-size: 2.5em; text-align: center; }
    .intro input { padding: 16px 20px; margin: 12px 0; width: 90%; max-width: 350px; border-radius: var(--button-radius); border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-light); font-size: 1em; }
    .intro input:focus { outline: none; border-color: var(--border-focus-color); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3), 0 0 12px var(--dark-green-glow); }
    .intro button { padding: 16px 35px; background: var(--primary-green); color: var(--bg-dark-theme); border: none; font-weight: bold; border-radius: var(--button-radius); margin-top: 30px; cursor: pointer; font-size: 1.25em; text-transform: uppercase; transition: all 0.2s; }
    .intro button:hover { background: var(--bright-green-glow); color: var(--bg-black); transform: translateY(-3px) scale(1.03); }
    #error { color: #ff6b6b; margin-top: 20px; }

    /* --- HEADER & GIF --- */
    header { background-color: rgba(13, 22, 18, 0.92); padding: 18px 15px; text-align: center; border-bottom: 1px solid var(--border-color); }
    header h1 { color: var(--primary-green); text-shadow: 0 0 7px var(--dark-green-glow); margin: 0; font-size: 2em; display: flex; align-items: center; justify-content: center; }
    header img { height: 40px; margin-left: 15px; filter: drop-shadow(0 0 10px var(--dark-green-glow)); }
    .gif-container { text-align: center; padding: 25px 10px; }
    .gif-container img { width: 100%; max-width: 400px; border-radius: var(--container-radius); border: 1px solid var(--border-color); }
    
    /* --- MAIN CONTROL PANEL --- */
    .main { padding: 25px; max-width: 640px; margin: 25px auto; background-color: var(--container-bg); border-radius: var(--container-radius); border: 1px solid transparent; box-shadow: 0 8px 30px rgba(0,0,0,0.5), 0 0 25px var(--shadow-color-soft), inset 0 0 15px rgba(0,0,0,0.4); position: relative; overflow: hidden; }
    .main::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: var(--container-radius); border: 2px solid transparent; background: linear-gradient(45deg, var(--primary-green), var(--text-green)) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0.6; pointer-events: none; transition: opacity 0.4s ease; }
    .main:hover::before { opacity: 1; box-shadow: 0 0 15px var(--container-border-glow); }
    
    #currentSelectionDisplay { text-align: center; margin-bottom: 20px; padding: 12px; background-color: rgba(0, 255, 127, 0.05); border: 1px solid var(--border-color); border-radius: var(--button-radius); font-size: 1em; color: var(--text-light); }
    .selection-area { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; padding: 20px; background-color: rgba(15, 35, 15, 0.6); border-radius: var(--container-radius); border: 1px solid var(--border-color); }
    .selection-area.disabled-during-predict { opacity: 0.5; pointer-events: none; }
    .selection-area .form-group { display: flex; flex-direction: column; flex-basis: calc(50% - 15px); }
    .selection-area label { margin-bottom: 10px; text-shadow: 0 0 4px var(--dark-green-glow); }
    .selection-area select { background: var(--input-bg); color: var(--text-light); border: 1px solid var(--border-color); border-radius: var(--button-radius); padding: 14px 18px; width: 100%; cursor: pointer; }
    .betting-area { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 30px; }
    .bet-btn { padding: 15px 10px; font-weight: bold; border-radius: var(--button-radius); cursor: pointer; text-align: center; flex-grow: 1; flex-basis: calc(33.33% - 10px); transition: all 0.2s ease-out; }
    .bet-btn.active { transform: scale(1.08); }
    .bet-btn#player { background-color: #007A7A; } .bet-btn#player.active { box-shadow: 0 0 20px #00FFFF; }
    .bet-btn#banker { background-color: #B32D2D; } .bet-btn#banker.active { box-shadow: 0 0 20px #FF5C5C; }
    .bet-btn#tie { background-color: #999922; } .bet-btn#tie.active { box-shadow: 0 0 20px #FFFF66; }
    .bet-btn#playerPair { background-color: #CC7A00; } .bet-btn#playerPair.active { box-shadow: 0 0 20px #FFA500; }
    .bet-btn#bankerPair { background-color: #993399; } .bet-btn#bankerPair.active { box-shadow: 0 0 20px #FF66FF; }
    .bet-btn#longbao { background-color: #228B22; } .bet-btn#longbao.active { box-shadow: 0 0 20px #32CD32; }

    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px var(--pulse-glow-color); } 50% { box-shadow: 0 0 25px var(--pulse-glow-color), 0 0 10px var(--primary-green); } }
    .predict-btn { width: 100%; padding: 20px; font-size: 1.45em; background: var(--primary-green); color: var(--bg-dark-theme); border: none; border-radius: var(--button-radius); font-weight: bold; cursor: pointer; text-transform: uppercase; margin-bottom: 15px; animation: pulse-glow 2.5s infinite ease-in-out; }
    .activate-btn { width: 100%; padding: 18px; font-size: 1.2em; background: var(--activate-orange); color: var(--bg-dark-theme); border: none; border-radius: var(--button-radius); font-weight: bold; cursor: pointer; text-transform: uppercase; margin-bottom: 30px; }
    #promoBannerF168 { background-color: var(--activate-orange); color: var(--bg-dark-theme); text-align: center; padding: 15px 10px; font-size: 1.1em; font-weight: bold; border-radius: var(--button-radius); }
    #promoBannerF168 a { color: var(--bg-dark-theme); text-decoration: none; }

    /* --- INTEGRATED GAME BOARD --- */
    #game-board-container {
        padding: 15px; background-color: rgba(0, 0, 0, 0.2);
        border-radius: var(--container-radius); border: 1px solid rgba(0, 255, 127, 0.15);
        perspective: 1200px; margin-bottom: 30px;
    }
    #game-board {
        width: 100%; max-width: 100%; height: 300px;
        background: radial-gradient(ellipse at center, rgba(26, 42, 34, 0.5) 0%, rgba(13, 26, 20, 0.5) 70%);
        border-radius: 10px; position: relative; display: flex; justify-content: space-around; align-items: center;
        transform: rotateX(10deg); overflow: hidden;
    }
    .card-area { width: 45%; }
    .card-slot-wrapper { display: flex; justify-content: center; gap: 5px; }
    .card-slot { position: relative; width: 80px; height: 112px; }
    .card { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.8s; }
    .card.is-flipped { transform: rotateY(180deg); }
    .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 6px; }
    .card-back { background: linear-gradient(45deg, #113322, #225544); border: 1px solid var(--primary-green); }
    .card-front { background: rgba(10, 30, 20, 0.8); border: 1px solid var(--border-color); backdrop-filter: blur(5px); color: white; transform: rotateY(180deg); display: flex; justify-content: center; align-items: center; font-family: 'Arial', sans-serif; font-size: 1.8em; font-weight: bold; }
    .score-display { z-index: 2; position: absolute; top: 15px; font-size: 2.8em; font-weight: 700; color: white; }
    .player-score { left: 40px; text-shadow: 0 0 15px #00FFFF, 0 0 25px #00FFFF; }
    .banker-score { right: 40px; text-shadow: 0 0 15px #FF5C5C, 0 0 25px #FF5C5C; }
    
    @keyframes win-glow { from { text-shadow: 0 0 20px; } to { text-shadow: 0 0 40px, 0 0 60px; } }
    #result-announcement {
        position: absolute; top: 50%; left: 50%; font-size: 3em; font-weight: bold; z-index: 100;
        padding: 10px 20px; border-radius: 10px; text-transform: uppercase;
        transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: translate(-50%, -50%) scale(0.8);
    }
    #result-announcement.visible { opacity: 1; transform: translate(-50%, -50%) scale(1); animation: win-glow 1s infinite alternate; }
    #result-announcement.player-win { color: #00FFFF; }
    #result-announcement.banker-win { color: #FF5C5C; }
    #result-announcement.tie-win { color: #FFFF66; }

    /* --- RESPONSIVE FOR MOBILE --- */
    @media (max-width: 600px) {
      .main { padding: 15px; }
      .selection-area .form-group { flex-basis: 100%; margin-bottom: 15px; }
      .bet-btn { flex-basis: calc(50% - 8px); }
      #game-board-container { perspective: none; }
      #game-board { transform: none; height: auto; flex-direction: column; gap: 20px; padding: 15px 0; }
      .card-area { width: 100%; }
      .card-slot { width: 70px; height: 98px; }
      .score-display { position: relative; top: auto; left: auto; right: auto; text-align: center; font-size: 2em; }
      .player-score { order: 1; }
      #player-card-area { order: 2; }
      .banker-score { order: 3; margin-top: 15px; }
      #banker-card-area { order: 4; }
      #result-announcement { font-size: 2em; }
    }
  </style>
</head>
<body>

  <div id="introTextOverlay">
    <p id="introLine1"></p>
    <p id="introLine2"></p>
    <p id="introLine3"></p>
  </div>

  <canvas id="matrix"></canvas>

  <div class="intro" id="loginScreen">
    <h2>ĐĂNG NHẬP HACK BACARAT MARK 8</h2>
    <input type="text" id="username" placeholder="Tên tài khoản" />
    <input type="text" id="code" placeholder="Mã truy cập" />
    <button onclick="checkCode()">Xác nhận</button>
    <p id="error"></p>
  </div>
  
  <div id="app" class="hidden">
    <header>
      <h1>HACK BACARAT MARK 8 <img src="49253552-3667-47ce-8411-102835f4406e.png" alt="Logo"/></h1>
    </header>

    <div class="gif-container">
      <img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExZm5kbGRjdmI0Nm9sdmdyNTI4Mmpwd2ZuNmtrajMycWZvaGR6ZHh5ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/wjwVTiNZVR1hOdFcu3/giphy.gif" alt="AI Dealing Cards"/>
    </div>

    <div class="main">
      <div id="currentSelectionDisplay" class="empty-selection">Vui lòng chọn sảnh và bàn...</div>
      
      <div class="selection-area" id="selectionAreaControls">
        <div class="form-group">
          <label for="lobby-select">CHỌN SẢNH:</label>
          <select id="lobby-select">
            <option value="">-- Chọn sảnh --</option>
            <option value="SEXY">SEXY</option>
            <option value="DG">DG</option>
          </select>
        </div>
        <div class="form-group">
          <label for="table-select">CHỌN BÀN:</label>
          <select id="table-select" disabled>
            <option value="">-- Chọn bàn --</option>
          </select>
        </div>
      </div>

      <div class="betting-area">
        <div class="bet-btn" id="player">PLAYER</div>
        <div class="bet-btn" id="banker">BANKER</div>
        <div class="bet-btn" id="tie">TIE</div>
        <div class="bet-btn" id="playerPair">CON ĐÔI</div>
        <div class="bet-btn" id="bankerPair">CÁI ĐÔI</div>
        <div class="bet-btn" id="longbao">LONG BẢO</div>
      </div>

      <button class="predict-btn" id="predictBtn" onclick="predictResult()">DỰ ĐOÁN VÁN MỚI</button>
      
      <button class="activate-btn" id="activateAutoPlayBtn">KÍCH HOẠT TỰ ĐỘNG CHƠI</button>
      
      <div id="game-board-container">
        <div id="game-board">
            <div id="result-announcement" class="hidden"></div>
            <div class="score-display player-score" id="playerScore">0</div>
            <div class="score-display banker-score" id="bankerScore">0</div>
            
            <div class="card-area" id="player-card-area">
                <div class="card-slot-wrapper">
                    <div class="card-slot" id="player-card-1"></div>
                    <div class="card-slot" id="player-card-2"></div>
                    <div class="card-slot" id="player-card-3"></div>
                </div>
            </div>
            
            <div class="card-area" id="banker-card-area">
                <div class="card-slot-wrapper">
                    <div class="card-slot" id="banker-card-1"></div>
                    <div class="card-slot" id="banker-card-2"></div>
                    <div class="card-slot" id="banker-card-3"></div>
                </div>
            </div>
        </div>
      </div>

      <div id="promoBannerF168">
          ĐĂNG KÍ TẠI <a href="http://WWW.F168.CODES" target="_blank">WWW.F168.CODES</a>
      </div>
    </div>
  </div>

  <audio id="soundEffect" src="deal.mp3"></audio>

  <script>
    // Toàn bộ JavaScript không cần thay đổi so với phiên bản trước đó
    // vì chúng ta chỉ thay đổi vị trí của các element HTML mà JS vẫn có thể tìm thấy qua ID.
    var Tawk_API = Tawk_API || {};
    Tawk_API.onLoad = function(){ if (Tawk_API && typeof Tawk_API.hideWidget === 'function') { Tawk_API.hideWidget(); } };
    const validCodes = [ "167904", "582173", "907348", "213560", "638901", "475289", "801452", "026815", "749063", "350728", "112233", "445566", "778899", "001122", "654321", "987650", "246802", "135791", "505050", "864209" ];
    const autoPlayActivationCodes = ["73015", "82649", "10527", "94380", "05162", "33894", "67201", "49058", "21736", "58423"];
    const introTextOverlayElement = document.getElementById('introTextOverlay');
    const loginScreenElement = document.getElementById('loginScreen');
    const appScreen = document.getElementById('app');
    const predictButton = document.getElementById('predictBtn');
    const selectionControls = document.getElementById('selectionAreaControls');
    const lobbySelectElement = document.getElementById('lobby-select');
    const tableSelectElement = document.getElementById('table-select');
    const currentSelectionDisplay = document.getElementById('currentSelectionDisplay');
    const sound = document.getElementById('soundEffect');
    const gameBoard = document.getElementById('game-board');
    const playerScoreDisplay = document.getElementById('playerScore');
    const bankerScoreDisplay = document.getElementById('bankerScore');
    const playerCardArea = document.getElementById('player-card-area');
    const bankerCardArea = document.getElementById('banker-card-area');
    const resultAnnouncement = document.getElementById('result-announcement');
    const introTextLines = [ { elId: 'introLine1', text: "ĐANG KHỞI ĐỘNG...", speed: 80, isStrong: false, delayAfter: 400 }, { elId: 'introLine2', text: "LONGBAO 88 A.I BACARAT", speed: 100, isStrong: true, delayAfter: 600 }, { elId: 'introLine3', text: "A.I ĐẦU TIÊN VÀ THÔNG MINH NHẤT CHƠI BỘ MÔN BACARAT", speed: 60, isStrong: false, delayAfter: 1500 } ];
    function typeWriterEffect(element, text, speed, callback) { let i = 0; element.innerHTML = ''; element.classList.add('typewriter-cursor'); function type() { if (i < text.length) { element.innerHTML += text.charAt(i); i++; setTimeout(type, speed); } else { element.classList.remove('typewriter-cursor'); if (callback) setTimeout(callback, 50); } } type(); }
    function startTextIntroAnimation() { let currentLineIndex = 0; function animateNextIntroLine() { if (currentLineIndex < introTextLines.length) { const lineData = introTextLines[currentLineIndex]; const lineElement = document.getElementById(lineData.elId); if (lineElement) { if (lineData.isStrong) lineElement.classList.add('strong-line'); const startDelay = (currentLineIndex === 0) ? 700 : 0; setTimeout(() => { typeWriterEffect(lineElement, lineData.text, lineData.speed, () => { currentLineIndex++; setTimeout(animateNextIntroLine, lineData.delayAfter || 300); }); }, startDelay); } else { currentLineIndex++; animateNextIntroLine(); } } else { hideIntroOverlay(); } } animateNextIntroLine(); }
    function hideIntroOverlay() { if (introTextOverlayElement) introTextOverlayElement.classList.add('hidden-overlay'); }
    function checkCode() { const codeInput = document.getElementById("code"); const usernameInput = document.getElementById("username"); const error = document.getElementById("error"); if (!usernameInput.value.trim() || !codeInput.value.trim()) { error.textContent = "Vui lòng nhập đầy đủ thông tin!"; return; } if (validCodes.includes(codeInput.value.trim())) { loginScreenElement.classList.add("hidden"); appScreen.classList.remove("hidden"); } else { error.textContent = "Mã truy cập hoặc Tên tài khoản không hợp lệ!"; } }
    function speakResult(text) { if ('speechSynthesis' in window) { const msg = new SpeechSynthesisUtterance(text); msg.lang = 'en-US'; speechSynthesis.speak(msg); } }
    function createCardElement(value, suit) { return `<div class="card" data-value="${value}${suit}"><div class="card-face card-back"></div><div class="card-face card-front">${value}</div></div>`; }
    function getBaccaratValue(cardValue) { if (['K', 'Q', 'J', '10'].includes(cardValue)) return 0; if (cardValue === 'A') return 1; return parseInt(cardValue); }
    function clearTable() { document.querySelectorAll('.card-slot').forEach(slot => slot.innerHTML = ''); playerCardArea.classList.remove('winner'); bankerCardArea.classList.remove('winner'); resultAnnouncement.className = 'hidden'; playerScoreDisplay.textContent = '0'; bankerScoreDisplay.textContent = '0'; document.querySelectorAll('.betting-area .bet-btn').forEach(btn => btn.classList.remove('active')); }
    function predictResult() { if (!lobbySelectElement.value || !tableSelectElement.value) { alert("Vui lòng chọn sảnh và bàn!"); return; } clearTable(); predictButton.disabled = true; selectionControls.classList.add('disabled-during-predict'); if(sound) sound.play().catch(e => console.log(e)); animateDealing(); }
    async function animateDealing() {
        const suits = ['♥', '♦', '♣', '♠']; const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        let deck = []; for (const suit of suits) { for (const value of values) { deck.push({ value, suit }); } }
        deck.sort(() => Math.random() - 0.5);
        const playerCards = [deck.pop(), deck.pop()]; const bankerCards = [deck.pop(), deck.pop()];
        let playerScore = (getBaccaratValue(playerCards[0].value) + getBaccaratValue(playerCards[1].value)) % 10;
        let bankerScore = (getBaccaratValue(bankerCards[0].value) + getBaccaratValue(bankerCards[1].value)) % 10;
        const dealCard = (player, cardIndex, cardData) => { return new Promise(resolve => { const slot = document.getElementById(`${player}-card-${cardIndex + 1}`); slot.innerHTML = createCardElement(cardData.value, cardData.suit); setTimeout(() => { slot.querySelector('.card').classList.add('is-flipped'); if (sound) sound.play(); resolve(); }, 200); }); };
        await dealCard('player', 0, playerCards[0]); await new Promise(r => setTimeout(r, 250)); await dealCard('banker', 0, bankerCards[0]); await new Promise(r => setTimeout(r, 250)); await dealCard('player', 1, playerCards[1]); await new Promise(r => setTimeout(r, 250)); await dealCard('banker', 1, bankerCards[1]);
        playerScoreDisplay.textContent = playerScore; bankerScoreDisplay.textContent = bankerScore;
        let playerNeedsCard = playerScore <= 5; let bankerNeedsCard = false;
        if (playerScore < 8 && bankerScore < 8) {
            if (playerNeedsCard) {
                await new Promise(r => setTimeout(r, 600)); const p3 = deck.pop(); await dealCard('player', 2, p3); playerScore = (playerScore + getBaccaratValue(p3.value)) % 10; playerScoreDisplay.textContent = playerScore;
                const p3v = getBaccaratValue(p3.value);
                if (bankerScore <= 2 || (bankerScore === 3 && p3v !== 8) || (bankerScore === 4 && [2,3,4,5,6,7].includes(p3v)) || (bankerScore === 5 && [4,5,6,7].includes(p3v)) || (bankerScore === 6 && [6,7].includes(p3v))) bankerNeedsCard = true;
            } else if (bankerScore <= 5) { bankerNeedsCard = true; }
            if (bankerNeedsCard) { await new Promise(r => setTimeout(r, 600)); const b3 = deck.pop(); await dealCard('banker', 2, b3); bankerScore = (bankerScore + getBaccaratValue(b3.value)) % 10; bankerScoreDisplay.textContent = bankerScore; }
        }
        await new Promise(r => setTimeout(r, 800));
        let winner = '';
        if (playerScore > bankerScore) { winner = 'player'; playerCardArea.classList.add('winner'); document.getElementById('player').classList.add('active'); speakResult('Player'); } 
        else if (bankerScore > playerScore) { winner = 'banker'; bankerCardArea.classList.add('winner'); document.getElementById('banker').classList.add('active'); speakResult('Banker'); } 
        else { winner = 'tie'; playerCardArea.classList.add('winner'); bankerCardArea.classList.add('winner'); document.getElementById('tie').classList.add('active'); speakResult('Tie'); }
        if (Math.random() < 0.12) document.getElementById('playerPair').classList.add('active'); if (Math.random() < 0.12) document.getElementById('bankerPair').classList.add('active'); if (Math.random() < 0.25) document.getElementById('longbao').classList.add('active');
        resultAnnouncement.textContent = `${winner.replace(/^\w/, c => c.toUpperCase())} WINS`;
        if (winner === 'tie') resultAnnouncement.textContent = 'TIE';
        resultAnnouncement.className = `visible ${winner}-win`;
        predictButton.disabled = false; selectionControls.classList.remove('disabled-during-predict');
    }
    const tablesByLobby = { SEXY: ["C01", "C02", "C03"], DG: ["DG01", "DG02"] };
    function updateCurrentSelectionDisplay() { const l = lobbySelectElement.value, t = tableSelectElement.value; if (l && t) { currentSelectionDisplay.textContent = `Sảnh: ${l} - Bàn: ${t}`; } else if (l) { currentSelectionDisplay.textContent = `Sảnh: ${l} - Vui lòng chọn bàn...`; } else { currentSelectionDisplay.textContent = "Vui lòng chọn sảnh và bàn..."; } }
    function populateTables() { const l = lobbySelectElement.value; tableSelectElement.innerHTML = '<option value="">-- Chọn bàn --</option>'; if (l && tablesByLobby[l]) { tablesByLobby[l].forEach(t => { const o = document.createElement('option'); o.value = t; o.textContent = t; tableSelectElement.appendChild(o); }); tableSelectElement.disabled = false; } else { tableSelectElement.disabled = true; } updateCurrentSelectionDisplay(); }
    const canvas = document.getElementById('matrix'); const ctx = canvas.getContext('2d'); let matrixFontSize = 14; let matrixChars = '01'.split(''); let matrixColumns; let matrixDrops;
    function resizeMatrixCanvas() { if (!canvas) return; canvas.height = window.innerHeight; canvas.width = window.innerWidth; matrixColumns = Math.floor(canvas.width / matrixFontSize); matrixDrops = []; for (let i = 0; i < matrixColumns; i++) { matrixDrops[i] = 1 + Math.floor(Math.random() * (canvas.height / matrixFontSize)); } }
    function drawMatrix() { if (!ctx) return; ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height); const matrixRainColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-green').trim() || '#00FF7F'; ctx.fillStyle = matrixRainColor; ctx.font = matrixFontSize + 'px monospace'; for (let i = 0; i < matrixDrops.length; i++) { const text = matrixChars[Math.floor(Math.random() * matrixChars.length)]; ctx.fillText(text, i * matrixFontSize, matrixDrops[i] * matrixFontSize); if (matrixDrops[i] * matrixFontSize > canvas.height && Math.random() > 0.975) matrixDrops[i] = 0; matrixDrops[i]++; } }
    document.addEventListener('DOMContentLoaded', () => { if (introTextOverlayElement) startTextIntroAnimation(); if (sound) sound.load(); if (canvas) { resizeMatrixCanvas(); setInterval(drawMatrix, 33); } if (lobbySelectElement) lobbySelectElement.addEventListener('change', populateTables); if (tableSelectElement) tableSelectElement.addEventListener('change', updateCurrentSelectionDisplay); populateTables(); updateCurrentSelectionDisplay(); });
  </script>

</body>
</html>
